
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>Web & iOS dev – Ruby, Rails, RubyMotion & React</title>
  <meta name="author" content="Paul Sturgess">

  
  <meta name="description" content="Enzyme is a React Testing utility written
by the developers at Airbnb that is designed to make testing your components
much simpler and easier. Here &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://paulsturgess.github.io">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="/stylesheets/syntax.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="/atom.xml" rel="alternate" title="Web & iOS dev – Ruby, Rails, RubyMotion & React" type="application/atom+xml">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
  <script>!window.jQuery && document.write(unescape('%3Cscript src="./javascripts/lib/jquery.min.js"%3E%3C/script%3E'))</script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="http://fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href='http://fonts.googleapis.com/css?family=Open+Sans' rel='stylesheet' type='text/css'>
<link href='http://fonts.googleapis.com/css?family=Fjalla+One' rel='stylesheet' type='text/css'>
  
  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-75197-1']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>


</head>

<body   class="collapse-sidebar sidebar-footer" >
  <header role="banner"><hgroup>
  <h1><a href="/">Web & iOS dev – Ruby, Rails, RubyMotion & React</a></h1>
  
    <h2>Paul Sturgess</h2>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<ul class="main-navigation">
  <li><a href="/">Index</a></li>
  <li><a href="/blog/archives">Archives</a></li>
  <li><a href="https://twitter.com/paulsturgess">@paulsturgess</a></li>
  <li><a href="https://github.com/paulsturgess">Github</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div class="blog-index">
  
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2017/04/29/using-enzyme-to-test-a-react-component-onclick-with-event-preventdefault/">Using Enzyme to Test a React Component onClick With Event preventDefault</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2017-04-29T20:32:00+01:00" pubdate data-updated="true">Apr 29<span>th</span>, 2017</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p><a href="https://github.com/airbnb/enzyme">Enzyme</a> is a React Testing utility written
by the developers at Airbnb that is designed to make testing your components
much simpler and easier.</p>

<p>Here&#8217;s a quick tip for testing <code>onClick</code> functions where your code calls <code>event.preventDefault()</code></p>

<p>When triggering a click via the Enzyme api method <code>simulate</code>, you are not actually triggering a real event – the underlying implementation is simply calling the <code>onClick</code> prop of the node.</p>

<p>So if you&#8217;re calling <code>event.preventDefault()</code> in your code, you will need to pass
a second argument to <code>simulate</code>, which is a mock object, that is passed through to the event handler.</p>

<p>For example:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>const wrapper = shallow(&lt;YourComponent /&gt;);
</span><span class='line'>wrapper.find('a').simulate('click', { preventDefault() {} });</span></code></pre></td></tr></table></div></figure>


<p>Easy when you know how, but not immediately obvious. Fortunately the <a href="https://github.com/airbnb/enzyme/blob/master/docs/api/ShallowWrapper/simulate.md">Enzyme docs</a> are brilliant and well worth checking out for further detail and examples.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2017/02/08/making-and-testing-ajax-requests-with-axios-in-a-redux-app/">Making and Testing Ajax Requests With Axios in a Redux App</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2017-02-08T19:08:00+00:00" pubdate data-updated="true">Feb 8<span>th</span>, 2017</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>This article is going to explain how to perform and test Ajax requests in a React
application using Redux and <a href="https://github.com/mzabriskie/axios">Axios</a> which
is a promise based HTTP client.</p>

<p>I like Axios because of the way you can centrally configure the common behaviour
for the requests your front-end needs to make and the responses it receives.
To take one example, it has the concept of <a href="https://github.com/mzabriskie/axios#interceptors">interceptors</a>
that allow you to write a single function that can the handle responses such
as a 401 unauthorized or 500 exception.</p>

<p>When using Axios I like to create a utility &#8216;Service&#8217; class to setup the centralised
config and ensure all Ajax requests get handled consistently.</p>

<p>It also means calls to Axios are not sprinkled all over the codebase, so I could
swap out Axios for an alternative library and I should only need to update this
one wrapper class.</p>

<script src="https://gist.github.com/paulsturgess/ebfae1d1ac1779f18487d3dee80d1258.js"></script>


<p>In a Redux application, actions are purely functional and thus &#8216;side-effect free&#8217;. So in order to perform Ajax requests you will need middleware such as <a href="https://github.com/gaearon/redux-thunk">&#8216;redux-thunk&#8217;</a>. An alternative, that I&#8217;ve not used but heard good things of, is <a href="https://github.com/redux-loop/redux-loop">redux-loop</a>.</p>

<p>Redux Thunk means you can return a function from your action to delay the dispatch
of it, or only dispatch if a condition is met (like the response status is 200).</p>

<p>Once Redux Thunk is installed, you can return a function in your Action as shown by
<code>saveResource</code> in the example below:</p>

<script src="https://gist.github.com/paulsturgess/2335a83355a22a6d06bf72d2f462a776.js"></script>


<p>Then for any containers that you want to use the action, you need to pass through the dispatch to the function in the <code>mapDispatchToProps</code>. See <code>saveResource</code> below:</p>

<script src="https://gist.github.com/paulsturgess/dc495342470f006a6c60a97d29584456.js"></script>


<p>To test the action you can use standard jasmine spy functions:</p>

<script src="https://gist.github.com/paulsturgess/adcc72f752fa5381bc0ca22c0be91c32.js"></script>


<p>Then finally to test the Service class:</p>

<script src="https://gist.github.com/paulsturgess/f1813e0cee2d39ea3b57ca155ec7fee7.js"></script>


<p>There are a few bits here to go through here. Firstly I found that when running the specs
I needed to add the <a href="https://www.npmjs.com/package/babel-polyfill">babel-polyfill</a> for Promises. I&#8217;m using <a href="https://karma-runner.github.io/1.0/index.html">Karma test runner</a> so I needed to add <code>'node_modules/babel-polyfill/dist/polyfill.js'</code> to the files array in the karma.config.js
file.</p>

<p>Secondly at the top of the spec you&#8217;ll notice that <a href="https://github.com/jasmine/jasmine-ajax">jasmine-ajax</a> is imported. This is the official plugin for faking Ajax requests in your Jasmine specs. What I like about this
is that it has no knowledge of Axios. In the <code>beforeEach</code> it is turned on and
then all Ajax requests triggered in the specs are captured and can be inspected.</p>

<p>Due to the asynchronous nature of the promise, I use <code>setTimeout</code> to grab the
most recent request and check it was formed correctly. To test the callback
I use the <code>then</code> function on the promise under test.</p>

<p>A small, but important, detail is the call to <code>done()</code> – this ensures the test
does not exit early and waits until the asynchronous part of the test is complete
before exiting.</p>

<p>And that&#8217;s it! There&#8217;s a lot of code there, but once the Service class is setup it
should remain pretty much unchanged. Adding additional Ajax requests to your React application actions should be fairly straight forward.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2017/02/01/using-capybara-and-phantomjs-to-test-an-external-website/">Using Capybara and PhantomJS to Test an External Website</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2017-02-01T19:14:00+00:00" pubdate data-updated="true">Feb 1<span>st</span>, 2017</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p><a href="https://github.com/teamcapybara/capybara">Capybara</a> is a great way for performing
integration testing of web applications. Typically it is used in development with
the default Rack Test Driver. However, the Rack Test driver does not support JavaScript
and is unable to access HTTP resources outside of your Rack application.</p>

<p>Enter <a href="http://phantomjs.org/">PhantomJS</a> – a headless implementation of Webkit
that can execute JavaScript, external urls and works with Capybara. The easiest
way to get the two to talk together is via the <a href="https://github.com/teampoltergeist/poltergeist">Poltergeist gem</a>.</p>

<p>I created an example repo with all the required config and setup via Docker: <a href="https://github.com/paulsturgess/capybara_phantomjs">https://github.com/paulsturgess/capybara_phantomjs</a></p>

<p>But essentially it boils down to:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="nb">require</span> <span class="s1">&#39;capybara&#39;</span>
</span><span class='line'><span class="nb">require</span> <span class="s1">&#39;capybara/dsl&#39;</span>
</span><span class='line'><span class="nb">require</span> <span class="s1">&#39;capybara/poltergeist&#39;</span>
</span><span class='line'>
</span><span class='line'><span class="vg">$stdout</span><span class="o">.</span><span class="n">sync</span> <span class="o">=</span> <span class="kp">true</span>
</span><span class='line'>
</span><span class='line'><span class="k">class</span> <span class="nc">Demo</span>
</span><span class='line'>  <span class="kp">include</span> <span class="ss">Capybara</span><span class="p">:</span><span class="ss">:DSL</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">def</span> <span class="nc">self</span><span class="o">.</span><span class="nf">run</span>
</span><span class='line'>    <span class="kp">new</span><span class="o">.</span><span class="n">run</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">def</span> <span class="nf">initialize</span>
</span><span class='line'>    <span class="n">setup_poltergeist</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">def</span> <span class="nf">run</span>
</span><span class='line'>    <span class="n">visit</span><span class="p">(</span><span class="s1">&#39;https://google.com&#39;</span><span class="p">)</span>
</span><span class='line'>    <span class="n">save_page</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>  <span class="kp">private</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">def</span> <span class="nf">setup_poltergeist</span>
</span><span class='line'>    <span class="no">Capybara</span><span class="o">.</span><span class="n">register_driver</span> <span class="ss">:poltergeist</span> <span class="k">do</span> <span class="o">|</span><span class="n">app</span><span class="o">|</span>
</span><span class='line'>      <span class="ss">Capybara</span><span class="p">:</span><span class="ss">:Poltergeist</span><span class="o">::</span><span class="no">Driver</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="n">app</span><span class="p">,</span> <span class="n">polyergeist_options</span><span class="p">)</span>
</span><span class='line'>    <span class="k">end</span>
</span><span class='line'>    <span class="no">Capybara</span><span class="o">.</span><span class="n">default_driver</span> <span class="o">=</span> <span class="ss">:poltergeist</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">def</span> <span class="nf">polyergeist_options</span>
</span><span class='line'>    <span class="p">{</span> <span class="n">js_errors</span><span class="p">:</span> <span class="kp">false</span> <span class="p">}</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'><span class="k">end</span>
</span><span class='line'>
</span><span class='line'><span class="no">Demo</span><span class="o">.</span><span class="n">run</span>
</span></code></pre></td></tr></table></div></figure>

</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2017/01/11/simple-method-for-checking-the-mime-type-for-a-file-in-ruby-on-rails/">Simple Method for Checking a File Mime Type in Ruby on Rails</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2017-01-11T19:16:00+00:00" pubdate data-updated="true">Jan 11<span>th</span>, 2017</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>When accepting file uploads from users of your application, you should always
check the file to ensure malicious content isn&#8217;t permitted.</p>

<p>If you have a simple Rails <code>file_field</code> in a multipart form, you&#8217;ll get a <a href="http://api.rubyonrails.org/classes/ActionDispatch/Http/UploadedFile.html">ActionDispatch::Http::UploadedFile</a>. This object wraps up the temporary uploaded file and has methods
like <code>content_type</code> and <code>original_filename</code>.</p>

<p>At first glance it sounds sensible to check the extension (determined from <code>original_filename</code>) along with the <code>content_type</code>, against a whitelist of allowed
values. However, if the pesky user has renamed the file extension before uploading
the file, your whitelist will not help you as even <code>content_type</code> will return the
incorrect value.</p>

<p>This is why checking the mime type of the file is important, but this is not
something Ruby does natively. There are a few Ruby gems around which specifically
handle this problem but the simplest solution I found, without requiring any third
party dependencies, was to use the underlying Operating System and execute the
<a href="http://man7.org/linux/man-pages/man1/file.1.html">file command</a> via back ticks:</p>

<div class="highlight"><pre><code class="ruby">  <span class="sb">`file --b --mime-type &#39;/path/to/file.txt&#39;`</span><span class="o">.</span><span class="n">strip</span>
</code></pre></div>


<p>This works on both Linux and OS X and will return the mime type such as
&#8216;text/plain&#8217;, which can then be used as part of your validation.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2016/11/20/functional-programming-for-a-rubyist/">Functional Programming for a Rubyist</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2016-11-20T12:22:00+00:00" pubdate data-updated="true">Nov 20<span>th</span>, 2016</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>Functional programming has piqued my interest for a while – it appears to be reaching
a tipping point with the rise of <a href="https://facebook.github.io/react/">ReactJS</a>, <a href="http://redux.js.org/">Redux</a>, <a href="http://elm-lang.org/">Elm</a> and <a href="https://facebook.github.io/immutable-js/">ImmutableJS</a>
bringing Functional Programming to a whole new set of developers through Javascript.</p>

<p><a href="http://elixir-lang.org/">Elixir</a> is also a functional programming language that&#8217;s
attracting a lot of the Ruby community.</p>

<p>As an object-orientated Rubyist, I&#8217;ve been exposed to some functional programming
ideas through Blocks, Procs and Lambdas but when programming in Ruby you&#8217;re typically
mutating state all over the place.</p>

<p>Pure functional programming works with immutable state.</p>

<h2>Coursera</h2>

<p>To learn more about functional programming, I&#8217;ve just successfully completed the
Coursera course <a href="https://www.coursera.org/learn/progfun1">Functional Programming Principles in Scala</a>
taught by the creator of <a href="http://www.scala-lang.org/">Scala</a>, Martin Odersky.</p>

<p>Although I didn&#8217;t set out to specifically learn Scala, I decided to take the
course because the <a href="https://www.coursera.org/learn/progfun1#ratings">reviews from fellow programmers</a>
highly recommended it for learning Functional Programming. I think they were right – it&#8217;s
a very well put together course and it&#8217;s also really tough.</p>

<p>It completely challenges the way you think when you are used to writing imperative code.
The course is definitely less about learning Scala and more focussed on the fundamentals
of functional programming. Interestingly Scala actually allows both the worlds of
functional and object-orientated to co-exist.</p>

<p>Each week you have an assignment to complete that you can upload your program directly
from your IDE – there&#8217;s an automated test suite that will grade your submission.</p>

<h2>Side effect free</h2>

<p>So one of the reasons functional programming is gaining popularity is because one of
the main cited benefits is that the code is easier to reason about due to being
&#8216;side-effect free&#8217;.</p>

<p>It&#8217;s this immutability that is at the core of React &amp; Redux, especially for performance.</p>

<p>When a component&#8217;s props or state change, React decides whether an actual DOM update
is necessary. By using immutable state, it&#8217;s very easy to track if an object
has changed. The React documentation has a really good detailed explanation on <a href="https://facebook.github.io/react/docs/optimizing-performance.html">Optimizing Performance</a>.</p>

<h2>Scalable</h2>

<p>Functional programming languages are often talked about as being highly performant, but
what does this mean?</p>

<p>The future trend for computing appears to be more cores and one the way to make best
use of the hardware is to run code in parallel. This is where that &#8216;side-effect free&#8217;
code comes into play as makes it a lot easier to run in parallel.</p>

<h2>The Future</h2>

<p>Functional programming is certainly a completely different mindset for those of
us used to object-oriented programs. It will be really interesting to see if it
does become the mainstream approach to building web applications. I think I might
start trying to apply some functional programming in Ruby and see how I get on.</p>

<p>Further Reading&#8230;</p>

<ul>
<li><a href="http://www.rubypigeon.com/posts/avoid-mutation-functional-style-in-ruby/">Avoid mutation in Ruby</a></li>
<li><a href="http://www.rubypigeon.com/posts/isolate-side-effects-functional-style-in-ruby/">Isolate side-effects in Ruby</a></li>
<li><a href="http://blog.carbonfive.com/2014/01/26/applying-functional-programming-principles-to-your-rails-codebase/">Applying functional programming in Rails</a></li>
</ul>

</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2016/11/06/how-to-write-and-test-a-redux-container-component-for-react/">How to Write and Test a Redux Container Component for React</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2016-11-06T20:25:00+00:00" pubdate data-updated="true">Nov 6<span>th</span>, 2016</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>As a follow on from my last article about <a href="http://paulsturgess.co.uk/blog/2016/10/19/how-to-write-and-test-a-stateless-react-component/">building and testing stateless presentational components</a>, I&#8217;m going to explain Redux Container Components.</p>

<h2>What is a container component?</h2>

<p>A container component is concerned with how things work. This typically involves
fetching data, watching the store for updates and updating the store itself by
dispatching actions.</p>

<p>Essentially a container component will wrap a presentational component to add
behaviour to it.</p>

<h2>What does a container component look like?</h2>

<script src="https://gist.github.com/paulsturgess/7089b2386e8b86335fa7b681e3935c7a.js"></script>


<p>The container component is created on Line 16 via the <code>connect()</code> function provided
by Redux.</p>

<p>You can pass in additional functions to control how you want the state and the
actions mapped to the props. These are <code>mapStateToProps()</code> and <code>mapDispatchToProps()</code>.</p>

<p>In the example above, I&#8217;m using <code>mapDispatchToProps()</code> to setup the <code>addTodo</code> prop
that will dispatch the <code>addTodo</code> action we&#8217;ve imported. How this is used is entirely
down to the <code>AddToForm</code> presentational component and is outside the responsibility
of this component.</p>

<p>Note the first argument to <code>connect()</code> is null because I&#8217;m not using <code>mapStateToProps()</code>, but
the principle is the same as for <code>mapDispatchToProps()</code>.</p>

<h2>So how is a container component tested?</h2>

<p>Container components should be fairly lightweight. There seems little point testing
the <code>connect()</code> function, as this is not our code. But we do care that the props are
going into our wrapped <code>AddTodoForm</code> component correctly.</p>

<p>So to test this component, all I&#8217;m interested in is that the <code>addTodo</code> prop has
been setup to dispatch the required action to the store.</p>

<script src="https://gist.github.com/paulsturgess/e0f06a12821343d7854718c34394b60e.js"></script>


<p>The mock store and the <code>Provider</code> are required to render the connected component.</p>

<p>After that I&#8217;m just reaching into the component to grab the <code>addTodo</code> prop and calling
the function. I&#8217;m spying on the dispatch method in the store, that means I can check it&#8217;s
called with the action that&#8217;s formed correctly.</p>

<p>My test for the presentational component <code>AddTodoForm</code> will take care of checking
that the prop is actually triggered when it&#8217;s supposed to.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2016/10/19/how-to-write-and-test-a-stateless-react-component/">How to Write and Test a Stateless React Component</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2016-10-19T19:25:00+01:00" pubdate data-updated="true">Oct 19<span>th</span>, 2016</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>Recently I&#8217;ve been learning <a href="http://redux.js.org/">Redux</a> state container for <a href="https://facebook.github.io/react/">React</a> apps and it actively encourages
&#8216;stateless&#8217; components.  This blog post will describe how these can be written
and tested.</p>

<p>Note that you can write stateless components whether you&#8217;re using Redux or not!</p>

<h2>What is a stateless component?</h2>

<p>Redux introduces the concept of <a href="http://redux.js.org/docs/basics/UsageWithReact.html#presentational-and-container-components">&#8216;presentational&#8217; and &#8216;container&#8217; components</a> and the major difference between the two is that your presentational components
should not be aware of Redux.</p>

<p>Without getting into the details of exactly how Redux works, the consequence of
this separation of responsibilities means your presentational components can be
fairly simple.</p>

<p>Certainly if they don&#8217;t make use of any React lifecycle methods (like <a href="" title="http://paulsturgess.co.uk/blog/2016/05/04/how-to-test-react-lifecycle-method-componentdidupdate-when-the-component-props-change/">componentDidUpdate</a>) they can start life as a
simple function that just returns the required output.</p>

<h2>What does a stateless component look like?</h2>

<p>Below is an example taken from a Todo app, what it does isn&#8217;t important. The
key thing to notice is that it&#8217;s just a function that returns a list item.</p>

<p>Three props are defined <code>onClick</code>, <code>completed</code> and <code>text</code>. There&#8217;s no state
manipulation.</p>

<script src="https://gist.github.com/paulsturgess/db388c5f981775e96d8cb33d9fdcf073.js">
</script>


<h2>So how is stateless component tested?</h2>

<p>When using <code>ReactTestUtils.renderIntoDocument</code> it will not work with a stateless
component – you&#8217;ll get an error &#8216;instance must be a composite component&#8217;.</p>

<p>The way around this is to use a component created by extending <code>React.Component</code>
to wrap the stateless component. You&#8217;ll see in the test below a
<code>Wrapper</code> component is created.</p>

<p>Once you&#8217;ve done that you can reach into the component to grab out specific DOM
elements or other components.</p>

<script src="https://gist.github.com/paulsturgess/1cc50c28c6a0b622f9fddceb4d268c41.js">
</script>

</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2016/10/14/safer-rebasing-with-git/">Safer Rebasing With Git</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2016-10-14T18:32:00+01:00" pubdate data-updated="true">Oct 14<span>th</span>, 2016</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>Rebasing a <a href="https://git-scm.com/">git</a> branch is great way to maintain a clean commit history and it&#8217;s my
preferred way of getting changes into a feature branch (instead of merging). This
blog post will explain how I use it and how I make it safer to use.</p>

<h2>Caveat!</h2>

<p>Rebasing is dangerous because you are re-writing the branch history!</p>

<p>Imagine someone else has pulled down your branch and then you re-write history –
it will <em>really hurt</em> when it comes to combining both your changes.</p>

<p>If your feature branch will be worked on by multiple people, I would strongly urge
you do not rebase.</p>

<p>The git book does a great job of <a href="https://git-scm.com/book/ch3-6.html">describing rebasing in detail</a>,
including the pitfalls of rebasing public branches and what to do if you do if you
get really stuck after rebasing.</p>

<h2>My work flow</h2>

<p>For most projects I work on, feature branches are typically only contributed to
by one person – so rebasing is ok.</p>

<p>My work-flow for creating a feature branch from <code>master</code> is something like:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ git checkout -b feature/new_thing
</span><span class='line'>... I make various commits for feature related changes
</span><span class='line'>... Meanwhile, master is also updated
</span><span class='line'>$ git fetch
</span><span class='line'>$ git pull --rebase origin master</span></code></pre></td></tr></table></div></figure>


<p>This effectively re-writes the history of <code>feature/new_thing</code> to place my commits
after those made in <code>master</code>. There&#8217;s no merge commit, so it&#8217;s really neat and tidy.</p>

<p>I like the idea of opening a Pull Request as soon I start work on a feature.
I&#8217;ll then make &#8216;work in progress&#8217; commits as I go and push them up to the remote.
This gives people an early chance to review what I&#8217;m doing and lessens the chance
that my work might get lost if my computer blows up and my backup fails :)</p>

<p>But these commits can be messy and include changes I later revert, as I work on
the feature. I think it&#8217;s good practice to try and keep commits as logical and
concise as is reasonably possible. Ideally they will read like documentation for
the feature so that <code>git log</code> is like a story.</p>

<p>So during development, I won&#8217;t get too hung up on the commits. But eventually I
will use <a href="https://git-scm.com/book/ch7-6.html">interactive rebase</a> to re-order or
squash my commits into shape.</p>

<p>My interactive rebase work-flow is typically:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ git log
</span><span class='line'>... Find the sha for the last commit I want to leave alone
</span><span class='line'>$ git rebase -i sha-for-commit-to-leave-alone-goes-here</span></code></pre></td></tr></table></div></figure>


<p>It will then show something like this:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>pick f7f3f6d Initial work on feature
</span><span class='line'>pick 310154e Additional work on feature
</span><span class='line'>pick a5f4a0d Finish feature
</span><span class='line'>
</span><span class='line'># Commands:
</span><span class='line'>#  p, pick = use commit
</span><span class='line'>#  r, reword = use commit, but edit the commit message
</span><span class='line'>#  e, edit = use commit, but stop for amending
</span><span class='line'>#  s, squash = use commit, but meld into previous commit
</span><span class='line'>#  f, fixup = like "squash", but discard this commit's log message
</span><span class='line'>#  x, exec = run command (the rest of the line) using shell
</span><span class='line'>#
</span><span class='line'># These lines can be re-ordered; they are executed from top to bottom.</span></code></pre></td></tr></table></div></figure>


<p>Just edit <code>pick</code> to whatever action you want to perform and use <code>:wq</code> to save.</p>

<p>Now the next step is to push <code>feature/new_thing</code> to the remote and (other than the
first time I push) I&#8217;ll need to force push and this is where it gets dangerous!</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ git push -f origin feature/new_thing</span></code></pre></td></tr></table></div></figure>


<p>This will completely overwrite <code>feature/new_thing</code> whatever state it is in. Too bad if
someone else updated it, their changes are gone.</p>

<p>Accidentally type <code>feature/other_thing</code> and you&#8217;ve just blitzed the wrong branch!</p>

<h2>The safer way to force push</h2>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ git push --force-with-lease feature/new_thing</span></code></pre></td></tr></table></div></figure>


<p>Force with lease essentially checks the remote branch to see if it&#8217;s been updated
upstream and if so rejects the push and shows you a nice error message.</p>

<p>Beware that if you fetch, but don&#8217;t actually pull in the changes, <code>force-with-lease</code>
will not save you!</p>

<p>I want to always use <code>force-with-lease</code> over the standard <code>force</code> but this is
long to type so I have a git alias:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ git config --global alias.pushf "push --force-with-lease"</span></code></pre></td></tr></table></div></figure>


<p>Now I can safely use:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ git pushf origin feature/new_thing</span></code></pre></td></tr></table></div></figure>


<p>Got any git rebase tips? Feel free to contact me on Twitter <a href="https://twitter.com/paulsturgess">@paulsturgess</a></p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2016/09/29/elixir-london-conference-2016/">Elixir London Conference 2016</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2016-09-29T12:35:00+01:00" pubdate data-updated="true">Sep 29<span>th</span>, 2016</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>Last week the first ever <a href="http://www.elixir.london/">Elixir conference</a> was held in London and I was lucky enough to attend. It was brilliantly run with lots of great speakers and they&#8217;ve even got the <a href="http://www.elixir.london/#speakers">videos up online</a> already!</p>

<h2>Elixir and Ruby</h2>

<p><a href="http://elixir-lang.org/">Elixir</a> is a relatively new programming language that&#8217;s gaining in popularity fast, particularly amongst Ruby developers. During the conference they asked the audience to raise their hand if they had been, or are, a Ruby developer and over 75% did (myself included)!</p>

<p>So what&#8217;s attracting the Ruby community? Aside from the fact developers love shiny new things, this shiny new thing is different. That&#8217;s because Elixir runs on the <a href="http://www.erlang.org/">Erlang</a> BEAM which has been around for decades and was originally developed by Ericsson.</p>

<p>The key-note was from co-creator of Erlang,<a href="http://www.elixir.london/2016/robert-virding">Robert Virding</a>. It was fascinating to hear him talk about how Erlang was developed to solve the challenges Ericsson was facing building telecoms systems in the late 80&#8217;s, early 90&#8217;s. It&#8217;s amazing that the problems they solved are just as relevant in todays world of online software applications. One of the most high-profile recent adopters of Erlang is <a href="https://www.whatsapp.com/">WhatsApp</a>.</p>

<p>So what does this have to do with Ruby? Well Elixir inherits all of the characteristics that Erlang is known for:</p>

<ul>
<li>Concurrent</li>
<li>Fault tolerant</li>
<li>Easy to scale</li>
</ul>


<p>Often these are the same criticisms levelled at Ruby and Elixir provides an appealing syntax that looks a lot like Ruby.</p>

<h2>Phoenix</h2>

<p>The icing on the cake for Rails developers looking to transition to Elixir is <a href="http://www.phoenixframework.org/">Phoenix</a>. Phoenix takes a lot of the good ideas in Rails and adds all the benefits of Elixir such as the concurrency and fault tolerance.</p>

<p><a href="http://www.elixir.london/2016/gary-rennie">Gary Rennie</a> (core member of the Phoenix team) did a great job running through some best practices with controllers in Phoenix. He also explained why umbrella applications are a good idea to logically split your application where it makes sense.</p>

<p>As an aside, I recently came across this article from the creator of phoenix Chris McCord <a href="https://dockyard.com/blog/2016/08/09/phoenix-channels-vs-rails-action-cable">comparing Phoenix channels and Rails action cable</a> which makes for eye-opening reading.</p>

<h2>Nerves</h2>

<p>However, it&#8217;s not all about web applications and there were a few great talks and demonstrations showcasing embedded systems with Elixir. One of the most interesting discoveries for me was the <a href="http://nerves-project.org/">Nerves Project</a>.</p>

<p>The goal of Nerves is it make it simple for developers to write Elixir to interface with network and input/output devices, embed the code on a memory card, and run it on hardware like a <a href="https://www.raspberrypi.org/">Raspberry Pi</a>.</p>

<p><a href="http://www.elixir.london/2016/tetiana-dushenkivska">Ju Liu&#8217;s live coding demo</a> involved lots of various sensors (including lasers) and was a particular highlight.</p>

<h2>What&#8217;s next?</h2>

<p>Elixir is very young and there&#8217;s clearly lots of enthusiasm in the community. I&#8217;m definitely going to be keeping a close eye on the ecosystem that is already growing very quickly. There seems to be a lot of benefits to using Elixir for modern application development.</p>

<p>I definitely want to try writing an Elixir application and wrapping my head around functional programming (when I&#8217;m used to Object Oriented programming) is an interesting challenge I&#8217;ve been looking for an excuse to take on!</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2016/05/04/how-to-test-react-lifecycle-method-componentdidupdate-when-the-component-props-change/">How to Test React Lifecycle Method componentDidUpdate When the Component Props Change</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2016-05-04T22:12:00+01:00" pubdate data-updated="true">May 4<span>th</span>, 2016</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p><a href="https://facebook.github.io/react/">React</a> has many lifecycle methods you can hook behaviour onto, one of which is <code>componentDidUpdate</code>.</p>

<p>This blog will show you how to test this method using <a href="https://www.npmjs.com/package/react-dom">react-dom</a>.</p>

<p>Let&#8217;s say your component implements <code>componentDidUpdate</code> like this:</p>

<div class="highlight"><pre><code class="javascript"><span class="kr">import</span> <span class="nx">React</span> <span class="nx">from</span> <span class="s1">&#39;react&#39;</span><span class="p">;</span>

<span class="kr">class</span> <span class="nx">YourComponent</span> <span class="kr">extends</span> <span class="nx">React</span><span class="p">.</span><span class="nx">Component</span> <span class="p">{</span>
  <span class="nx">componentDidUpdate</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">someFunction</span><span class="p">();</span>
  <span class="p">}</span>

  <span class="nx">someFunction</span><span class="p">()</span> <span class="p">{</span>
    <span class="c1">// ...</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>


<p>Now say you want to test that <code>componentDidUpdate</code> calls <code>this.someFunction()</code>.</p>

<p>Because the props for the component are set on initial render, and cannot change after that, you can&#8217;t just render an instance of the component and manually update the props in your spec.</p>

<p>This is where <a href="https://www.npmjs.com/package/react-dom">react-dom</a> comes in. Use it to render the component with an initial set of props and then render the component again with different props.</p>

<p>react-dom will re-render the same instance of the component, instead of creating a brand new one each time.</p>

<div class="highlight"><pre><code class="javascript"><span class="kr">import</span> <span class="nx">React</span> <span class="nx">from</span> <span class="s1">&#39;react&#39;</span><span class="p">;</span>
<span class="kr">import</span> <span class="nx">ReactDOM</span> <span class="nx">from</span> <span class="s1">&#39;react-dom&#39;</span><span class="p">;</span>
<span class="kr">import</span> <span class="nx">YourComponent</span> <span class="nx">from</span> <span class="s1">&#39;path/to/your-component&#39;</span><span class="p">;</span>

<span class="nx">describe</span><span class="p">(</span><span class="s1">&#39;your-component&#39;</span><span class="p">,</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="nx">describe</span><span class="p">(</span><span class="s1">&#39;componentDidUpdate&#39;</span><span class="p">,</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="nx">it</span><span class="p">(</span><span class="s1">&#39;calls someFunction()&#39;</span><span class="p">,</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
      <span class="kd">let</span> <span class="nx">node</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">createElement</span><span class="p">(</span><span class="s1">&#39;div&#39;</span><span class="p">);</span>
      <span class="nx">instance</span> <span class="o">=</span> <span class="nx">ReactDOM</span><span class="p">.</span><span class="nx">render</span><span class="p">(</span><span class="o">&lt;</span><span class="nx">YourComponent</span> <span class="nx">yourProp</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;foo&#39;</span><span class="p">}</span> <span class="o">/&gt;</span><span class="p">,</span> <span class="nx">node</span><span class="p">);</span>
      <span class="nx">spyOn</span><span class="p">(</span><span class="nx">instance</span><span class="p">,</span> <span class="s1">&#39;someFunction&#39;</span><span class="p">);</span>
      <span class="nx">ReactDOM</span><span class="p">.</span><span class="nx">render</span><span class="p">(</span><span class="o">&lt;</span><span class="nx">YourComponent</span> <span class="nx">yourProp</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;bar&#39;</span><span class="p">}</span> <span class="o">/&gt;</span><span class="p">,</span> <span class="nx">node</span><span class="p">);</span>
      <span class="nx">expect</span><span class="p">(</span><span class="nx">instance</span><span class="p">.</span><span class="nx">someFunction</span><span class="p">).</span><span class="nx">toHaveBeenCalled</span><span class="p">();</span>
    <span class="p">});</span>
  <span class="p">});</span>
<span class="p">});</span>
</code></pre></div>



</div>
  
  


    </article>
  
  <div class="pagination">
    
      <a class="prev" href="/blog/page/2/">&larr; Older</a>
    
    
  </div>
</div>
<aside class="sidebar">
  
    <section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/blog/2017/04/29/using-enzyme-to-test-a-react-component-onclick-with-event-preventdefault/">Using Enzyme to test a React component onClick with event preventDefault</a>
      </li>
    
      <li class="post">
        <a href="/blog/2017/02/08/making-and-testing-ajax-requests-with-axios-in-a-redux-app/">Making and testing Ajax requests with Axios in a Redux app</a>
      </li>
    
      <li class="post">
        <a href="/blog/2017/02/01/using-capybara-and-phantomjs-to-test-an-external-website/">Using Capybara and PhantomJS to test an external website</a>
      </li>
    
      <li class="post">
        <a href="/blog/2017/01/11/simple-method-for-checking-the-mime-type-for-a-file-in-ruby-on-rails/">Simple method for checking a file mime type in Ruby on Rails</a>
      </li>
    
      <li class="post">
        <a href="/blog/2016/11/20/functional-programming-for-a-rubyist/">Functional Programming for a Rubyist</a>
      </li>
    
  </ul>
</section>

<section>
  <h1>GitHub Repos</h1>
  <ul id="gh_repos">
    <li class="loading">Status updating&#8230;</li>
  </ul>
  
  <a href="https://github.com/paulsturgess">@paulsturgess</a> on GitHub
  
  <script type="text/javascript">
    $(document).ready(function(){
        if (!window.jXHR){
            var jxhr = document.createElement('script');
            jxhr.type = 'text/javascript';
            jxhr.src = '/javascripts/libs/jXHR.js';
            var s = document.getElementsByTagName('script')[0];
            s.parentNode.insertBefore(jxhr, s);
        }

        github.showRepos({
            user: 'paulsturgess',
            count: 0,
            skip_forks: true,
            target: '#gh_repos'
        });
    });
  </script>
  <script src="/javascripts/github.js" type="text/javascript"> </script>
</section>





  
</aside>

    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2017 - Paul Sturgess -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  











</body>
</html>
