
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>Web & iOS dev – Ruby, Rails, RubyMotion & React</title>
  <meta name="author" content="Paul Sturgess">

  
  <meta name="description" content="When accepting file uploads from users of your application, you should always
check the file to ensure malicious content isn&#8217;t permitted. If &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://paulsturgess.github.io">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="/stylesheets/syntax.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="/atom.xml" rel="alternate" title="Web & iOS dev – Ruby, Rails, RubyMotion & React" type="application/atom+xml">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
  <script>!window.jQuery && document.write(unescape('%3Cscript src="./javascripts/lib/jquery.min.js"%3E%3C/script%3E'))</script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="http://fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href='http://fonts.googleapis.com/css?family=Open+Sans' rel='stylesheet' type='text/css'>
<link href='http://fonts.googleapis.com/css?family=Fjalla+One' rel='stylesheet' type='text/css'>
  
  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-75197-1']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>


</head>

<body   class="collapse-sidebar sidebar-footer" >
  <header role="banner"><hgroup>
  <h1><a href="/">Web & iOS dev – Ruby, Rails, RubyMotion & React</a></h1>
  
    <h2>Paul Sturgess</h2>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<ul class="main-navigation">
  <li><a href="/">Index</a></li>
  <li><a href="/blog/archives">Archives</a></li>
  <li><a href="https://twitter.com/paulsturgess">@paulsturgess</a></li>
  <li><a href="https://github.com/paulsturgess">Github</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div class="blog-index">
  
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2017/01/11/simple-method-for-checking-the-mime-type-for-a-file-in-ruby-on-rails/">Simple Method for Checking a File Mime Type in Ruby on Rails</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2017-01-11T19:16:00+00:00" pubdate data-updated="true">Jan 11<span>th</span>, 2017</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>When accepting file uploads from users of your application, you should always
check the file to ensure malicious content isn&#8217;t permitted.</p>

<p>If you have a simple Rails <code>file_field</code> in a multipart form, you&#8217;ll get a <a href="http://api.rubyonrails.org/classes/ActionDispatch/Http/UploadedFile.html">ActionDispatch::Http::UploadedFile</a>. This object wraps up the temporary uploaded file and has methods
like <code>content_type</code> and <code>original_filename</code>.</p>

<p>At first glance it sounds sensible to check the extension (determined from <code>original_filename</code>) along with the <code>content_type</code>, against a whitelist of allowed
values. However, if the pesky user has renamed the file extension before uploading
the file, your whitelist will not help you as even <code>content_type</code> will return the
incorrect value.</p>

<p>This is why checking the mime type of the file is important, but this is not
something Ruby does natively. There are a few Ruby gems around which specifically
handle this problem but the simplest solution I found, without requiring any third
party dependencies, was to use the underlying Operating System and execute the
<a href="http://man7.org/linux/man-pages/man1/file.1.html">file command</a> via back ticks:</p>

<div class="highlight"><pre><code class="ruby">  <span class="sb">`file --b --mime-type &#39;/path/to/file.txt&#39;`</span><span class="o">.</span><span class="n">strip</span>
</code></pre></div>


<p>This works on both Linux and OS X and will return the mime type such as
&#8216;text/plain&#8217;, which can then be used as part of your validation.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2016/11/20/functional-programming-for-a-rubyist/">Functional Programming for a Rubyist</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2016-11-20T12:22:00+00:00" pubdate data-updated="true">Nov 20<span>th</span>, 2016</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>Functional programming has piqued my interest for a while – it appears to be reaching
a tipping point with the rise of <a href="https://facebook.github.io/react/">ReactJS</a>, <a href="http://redux.js.org/">Redux</a>, <a href="http://elm-lang.org/">Elm</a> and <a href="https://facebook.github.io/immutable-js/">ImmutableJS</a>
bringing Functional Programming to a whole new set of developers through Javascript.</p>

<p><a href="http://elixir-lang.org/">Elixir</a> is also a functional programming language that&#8217;s
attracting a lot of the Ruby community.</p>

<p>As an object-orientated Rubyist, I&#8217;ve been exposed to some functional programming
ideas through Blocks, Procs and Lambdas but when programming in Ruby you&#8217;re typically
mutating state all over the place.</p>

<p>Pure functional programming works with immutable state.</p>

<h2>Coursera</h2>

<p>To learn more about functional programming, I&#8217;ve just successfully completed the
Coursera course <a href="https://www.coursera.org/learn/progfun1">Functional Programming Principles in Scala</a>
taught by the creator of <a href="http://www.scala-lang.org/">Scala</a>, Martin Odersky.</p>

<p>Although I didn&#8217;t set out to specifically learn Scala, I decided to take the
course because the <a href="https://www.coursera.org/learn/progfun1#ratings">reviews from fellow programmers</a>
highly recommended it for learning Functional Programming. I think they were right – it&#8217;s
a very well put together course and it&#8217;s also really tough.</p>

<p>It completely challenges the way you think when you are used to writing imperative code.
The course is definitely less about learning Scala and more focussed on the fundamentals
of functional programming. Interestingly Scala actually allows both the worlds of
functional and object-orientated to co-exist.</p>

<p>Each week you have an assignment to complete that you can upload your program directly
from your IDE – there&#8217;s an automated test suite that will grade your submission.</p>

<h2>Side effect free</h2>

<p>So one of the reasons functional programming is gaining popularity is because one of
the main cited benefits is that the code is easier to reason about due to being
&#8216;side-effect free&#8217;.</p>

<p>It&#8217;s this immutability that is at the core of React &amp; Redux, especially for performance.</p>

<p>When a component&#8217;s props or state change, React decides whether an actual DOM update
is necessary. By using immutable state, it&#8217;s very easy to track if an object
has changed. The React documentation has a really good detailed explanation on <a href="https://facebook.github.io/react/docs/optimizing-performance.html">Optimizing Performance</a>.</p>

<h2>Scalable</h2>

<p>Functional programming languages are often talked about as being highly performant, but
what does this mean?</p>

<p>The future trend for computing appears to be more cores and one the way to make best
use of the hardware is to run code in parallel. This is where that &#8216;side-effect free&#8217;
code comes into play as makes it a lot easier to run in parallel.</p>

<h2>The Future</h2>

<p>Functional programming is certainly a completely different mindset for those of
us used to object-oriented programs. It will be really interesting to see if it
does become the mainstream approach to building web applications. I think I might
start trying to apply some functional programming in Ruby and see how I get on.</p>

<p>Further Reading&#8230;</p>

<ul>
<li><a href="http://www.rubypigeon.com/posts/avoid-mutation-functional-style-in-ruby/">Avoid mutation in Ruby</a></li>
<li><a href="http://www.rubypigeon.com/posts/isolate-side-effects-functional-style-in-ruby/">Isolate side-effects in Ruby</a></li>
<li><a href="http://blog.carbonfive.com/2014/01/26/applying-functional-programming-principles-to-your-rails-codebase/">Applying functional programming in Rails</a></li>
</ul>

</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2016/11/06/how-to-write-and-test-a-redux-container-component-for-react/">How to Write and Test a Redux Container Component for React</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2016-11-06T20:25:00+00:00" pubdate data-updated="true">Nov 6<span>th</span>, 2016</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>As a follow on from my last article about <a href="http://paulsturgess.co.uk/blog/2016/10/19/how-to-write-and-test-a-stateless-react-component/">building and testing stateless presentational components</a>, I&#8217;m going to explain Redux Container Components.</p>

<h2>What is a container component?</h2>

<p>A container component is concerned with how things work. This typically involves
fetching data, watching the store for updates and updating the store itself by
dispatching actions.</p>

<p>Essentially a container component will wrap a presentational component to add
behaviour to it.</p>

<h2>What does a container component look like?</h2>

<script src="https://gist.github.com/paulsturgess/7089b2386e8b86335fa7b681e3935c7a.js"></script>


<p>The container component is created on Line 16 via the <code>connect()</code> function provided
by Redux.</p>

<p>You can pass in additional functions to control how you want the state and the
actions mapped to the props. These are <code>mapStateToProps()</code> and <code>mapDispatchToProps()</code>.</p>

<p>In the example above, I&#8217;m using <code>mapDispatchToProps()</code> to setup the <code>addTodo</code> prop
that will dispatch the <code>addTodo</code> action we&#8217;ve imported. How this is used is entirely
down to the <code>AddToForm</code> presentational component and is outside the responsibility
of this component.</p>

<p>Note the first argument to <code>connect()</code> is null because I&#8217;m not using <code>mapStateToProps()</code>, but
the principle is the same as for <code>mapDispatchToProps()</code>.</p>

<h2>So how is a container component tested?</h2>

<p>Container components should be fairly lightweight. There seems little point testing
the <code>connect()</code> function, as this is not our code. But we do care that the props are
going into our wrapped <code>AddTodoForm</code> component correctly.</p>

<p>So to test this component, all I&#8217;m interested in is that the <code>addTodo</code> prop has
been setup to dispatch the required action to the store.</p>

<script src="https://gist.github.com/paulsturgess/e0f06a12821343d7854718c34394b60e.js"></script>


<p>The mock store and the <code>Provider</code> are required to render the connected component.</p>

<p>After that I&#8217;m just reaching into the component to grab the <code>addTodo</code> prop and calling
the function. I&#8217;m spying on the dispatch method in the store, that means I can check it&#8217;s
called with the action that&#8217;s formed correctly.</p>

<p>My test for the presentational component <code>AddTodoForm</code> will take care of checking
that the prop is actually triggered when it&#8217;s supposed to.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2016/10/19/how-to-write-and-test-a-stateless-react-component/">How to Write and Test a Stateless React Component</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2016-10-19T19:25:00+01:00" pubdate data-updated="true">Oct 19<span>th</span>, 2016</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>Recently I&#8217;ve been learning <a href="http://redux.js.org/">Redux</a> state container for <a href="https://facebook.github.io/react/">React</a> apps and it actively encourages
&#8216;stateless&#8217; components.  This blog post will describe how these can be written
and tested.</p>

<p>Note that you can write stateless components whether you&#8217;re using Redux or not!</p>

<h2>What is a stateless component?</h2>

<p>Redux introduces the concept of <a href="http://redux.js.org/docs/basics/UsageWithReact.html#presentational-and-container-components">&#8216;presentational&#8217; and &#8216;container&#8217; components</a> and the major difference between the two is that your presentational components
should not be aware of Redux.</p>

<p>Without getting into the details of exactly how Redux works, the consequence of
this separation of responsibilities means your presentational components can be
fairly simple.</p>

<p>Certainly if they don&#8217;t make use of any React lifecycle methods (like <a href="" title="http://paulsturgess.co.uk/blog/2016/05/04/how-to-test-react-lifecycle-method-componentdidupdate-when-the-component-props-change/">componentDidUpdate</a>) they can start life as a
simple function that just returns the required output.</p>

<h2>What does a stateless component look like?</h2>

<p>Below is an example taken from a Todo app, what it does isn&#8217;t important. The
key thing to notice is that it&#8217;s just a function that returns a list item.</p>

<p>Three props are defined <code>onClick</code>, <code>completed</code> and <code>text</code>. There&#8217;s no state
manipulation.</p>

<script src="https://gist.github.com/paulsturgess/db388c5f981775e96d8cb33d9fdcf073.js">
</script>


<h2>So how is stateless component tested?</h2>

<p>When using <code>ReactTestUtils.renderIntoDocument</code> it will not work with a stateless
component – you&#8217;ll get an error &#8216;instance must be a composite component&#8217;.</p>

<p>The way around this is to use a component created by extending <code>React.Component</code>
to wrap the stateless component. You&#8217;ll see in the test below a
<code>Wrapper</code> component is created.</p>

<p>Once you&#8217;ve done that you can reach into the component to grab out specific DOM
elements or other components.</p>

<script src="https://gist.github.com/paulsturgess/1cc50c28c6a0b622f9fddceb4d268c41.js">
</script>

</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2016/10/14/safer-rebasing-with-git/">Safer Rebasing With Git</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2016-10-14T18:32:00+01:00" pubdate data-updated="true">Oct 14<span>th</span>, 2016</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>Rebasing a <a href="https://git-scm.com/">git</a> branch is great way to maintain a clean commit history and it&#8217;s my
preferred way of getting changes into a feature branch (instead of merging). This
blog post will explain how I use it and how I make it safer to use.</p>

<h2>Caveat!</h2>

<p>Rebasing is dangerous because you are re-writing the branch history!</p>

<p>Imagine someone else has pulled down your branch and then you re-write history –
it will <em>really hurt</em> when it comes to combining both your changes.</p>

<p>If your feature branch will be worked on by multiple people, I would strongly urge
you do not rebase.</p>

<p>The git book does a great job of <a href="https://git-scm.com/book/ch3-6.html">describing rebasing in detail</a>,
including the pitfalls of rebasing public branches and what to do if you do if you
get really stuck after rebasing.</p>

<h2>My work flow</h2>

<p>For most projects I work on, feature branches are typically only contributed to
by one person – so rebasing is ok.</p>

<p>My work-flow for creating a feature branch from <code>master</code> is something like:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ git checkout -b feature/new_thing
</span><span class='line'>... I make various commits for feature related changes
</span><span class='line'>... Meanwhile, master is also updated
</span><span class='line'>$ git fetch
</span><span class='line'>$ git pull --rebase origin master</span></code></pre></td></tr></table></div></figure>


<p>This effectively re-writes the history of <code>feature/new_thing</code> to place my commits
after those made in <code>master</code>. There&#8217;s no merge commit, so it&#8217;s really neat and tidy.</p>

<p>I like the idea of opening a Pull Request as soon I start work on a feature.
I&#8217;ll then make &#8216;work in progress&#8217; commits as I go and push them up to the remote.
This gives people an early chance to review what I&#8217;m doing and lessens the chance
that my work might get lost if my computer blows up and my backup fails :)</p>

<p>But these commits can be messy and include changes I later revert, as I work on
the feature. I think it&#8217;s good practice to try and keep commits as logical and
concise as is reasonably possible. Ideally they will read like documentation for
the feature so that <code>git log</code> is like a story.</p>

<p>So during development, I won&#8217;t get too hung up on the commits. But eventually I
will use <a href="https://git-scm.com/book/ch7-6.html">interactive rebase</a> to re-order or
squash my commits into shape.</p>

<p>My interactive rebase work-flow is typically:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ git log
</span><span class='line'>... Find the sha for the last commit I want to leave alone
</span><span class='line'>$ git rebase -i sha-for-commit-to-leave-alone-goes-here</span></code></pre></td></tr></table></div></figure>


<p>It will then show something like this:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>pick f7f3f6d Initial work on feature
</span><span class='line'>pick 310154e Additional work on feature
</span><span class='line'>pick a5f4a0d Finish feature
</span><span class='line'>
</span><span class='line'># Commands:
</span><span class='line'>#  p, pick = use commit
</span><span class='line'>#  r, reword = use commit, but edit the commit message
</span><span class='line'>#  e, edit = use commit, but stop for amending
</span><span class='line'>#  s, squash = use commit, but meld into previous commit
</span><span class='line'>#  f, fixup = like "squash", but discard this commit's log message
</span><span class='line'>#  x, exec = run command (the rest of the line) using shell
</span><span class='line'>#
</span><span class='line'># These lines can be re-ordered; they are executed from top to bottom.</span></code></pre></td></tr></table></div></figure>


<p>Just edit <code>pick</code> to whatever action you want to perform and use <code>:wq</code> to save.</p>

<p>Now the next step is to push <code>feature/new_thing</code> to the remote and (other than the
first time I push) I&#8217;ll need to force push and this is where it gets dangerous!</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ git push -f origin feature/new_thing</span></code></pre></td></tr></table></div></figure>


<p>This will completely overwrite <code>feature/new_thing</code> whatever state it is in. Too bad if
someone else updated it, their changes are gone.</p>

<p>Accidentally type <code>feature/other_thing</code> and you&#8217;ve just blitzed the wrong branch!</p>

<h2>The safer way to force push</h2>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ git push --force-with-lease feature/new_thing</span></code></pre></td></tr></table></div></figure>


<p>Force with lease essentially checks the remote branch to see if it&#8217;s been updated
upstream and if so rejects the push and shows you a nice error message.</p>

<p>Beware that if you fetch, but don&#8217;t actually pull in the changes, <code>force-with-lease</code>
will not save you!</p>

<p>I want to always use <code>force-with-lease</code> over the standard <code>force</code> but this is
long to type so I have a git alias:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ git config --global alias.pushf "push --force-with-lease"</span></code></pre></td></tr></table></div></figure>


<p>Now I can safely use:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ git pushf origin feature/new_thing</span></code></pre></td></tr></table></div></figure>


<p>Got any git rebase tips? Feel free to contact me on Twitter <a href="https://twitter.com/paulsturgess">@paulsturgess</a></p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2016/09/29/elixir-london-conference-2016/">Elixir London Conference 2016</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2016-09-29T12:35:00+01:00" pubdate data-updated="true">Sep 29<span>th</span>, 2016</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>Last week the first ever <a href="http://www.elixir.london/">Elixir conference</a> was held in London and I was lucky enough to attend. It was brilliantly run with lots of great speakers and they&#8217;ve even got the <a href="http://www.elixir.london/#speakers">videos up online</a> already!</p>

<h2>Elixir and Ruby</h2>

<p><a href="http://elixir-lang.org/">Elixir</a> is a relatively new programming language that&#8217;s gaining in popularity fast, particularly amongst Ruby developers. During the conference they asked the audience to raise their hand if they had been, or are, a Ruby developer and over 75% did (myself included)!</p>

<p>So what&#8217;s attracting the Ruby community? Aside from the fact developers love shiny new things, this shiny new thing is different. That&#8217;s because Elixir runs on the <a href="http://www.erlang.org/">Erlang</a> BEAM which has been around for decades and was originally developed by Ericsson.</p>

<p>The key-note was from co-creator of Erlang,<a href="http://www.elixir.london/2016/robert-virding">Robert Virding</a>. It was fascinating to hear him talk about how Erlang was developed to solve the challenges Ericsson was facing building telecoms systems in the late 80&#8217;s, early 90&#8217;s. It&#8217;s amazing that the problems they solved are just as relevant in todays world of online software applications. One of the most high-profile recent adopters of Erlang is <a href="https://www.whatsapp.com/">WhatsApp</a>.</p>

<p>So what does this have to do with Ruby? Well Elixir inherits all of the characteristics that Erlang is known for:</p>

<ul>
<li>Concurrent</li>
<li>Fault tolerant</li>
<li>Easy to scale</li>
</ul>


<p>Often these are the same criticisms levelled at Ruby and Elixir provides an appealing syntax that looks a lot like Ruby.</p>

<h2>Phoenix</h2>

<p>The icing on the cake for Rails developers looking to transition to Elixir is <a href="http://www.phoenixframework.org/">Phoenix</a>. Phoenix takes a lot of the good ideas in Rails and adds all the benefits of Elixir such as the concurrency and fault tolerance.</p>

<p><a href="http://www.elixir.london/2016/gary-rennie">Gary Rennie</a> (core member of the Phoenix team) did a great job running through some best practices with controllers in Phoenix. He also explained why umbrella applications are a good idea to logically split your application where it makes sense.</p>

<p>As an aside, I recently came across this article from the creator of phoenix Chris McCord <a href="https://dockyard.com/blog/2016/08/09/phoenix-channels-vs-rails-action-cable">comparing Phoenix channels and Rails action cable</a> which makes for eye-opening reading.</p>

<h2>Nerves</h2>

<p>However, it&#8217;s not all about web applications and there were a few great talks and demonstrations showcasing embedded systems with Elixir. One of the most interesting discoveries for me was the <a href="http://nerves-project.org/">Nerves Project</a>.</p>

<p>The goal of Nerves is it make it simple for developers to write Elixir to interface with network and input/output devices, embed the code on a memory card, and run it on hardware like a <a href="https://www.raspberrypi.org/">Raspberry Pi</a>.</p>

<p><a href="http://www.elixir.london/2016/tetiana-dushenkivska">Ju Liu&#8217;s live coding demo</a> involved lots of various sensors (including lasers) and was a particular highlight.</p>

<h2>What&#8217;s next?</h2>

<p>Elixir is very young and there&#8217;s clearly lots of enthusiasm in the community. I&#8217;m definitely going to be keeping a close eye on the ecosystem that is already growing very quickly. There seems to be a lot of benefits to using Elixir for modern application development.</p>

<p>I definitely want to try writing an Elixir application and wrapping my head around functional programming (when I&#8217;m used to Object Oriented programming) is an interesting challenge I&#8217;ve been looking for an excuse to take on!</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2016/05/04/how-to-test-react-lifecycle-method-componentdidupdate-when-the-component-props-change/">How to Test React Lifecycle Method componentDidUpdate When the Component Props Change</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2016-05-04T22:12:00+01:00" pubdate data-updated="true">May 4<span>th</span>, 2016</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p><a href="https://facebook.github.io/react/">React</a> has many lifecycle methods you can hook behaviour onto, one of which is <code>componentDidUpdate</code>.</p>

<p>This blog will show you how to test this method using <a href="https://www.npmjs.com/package/react-dom">react-dom</a>.</p>

<p>Let&#8217;s say your component implements <code>componentDidUpdate</code> like this:</p>

<div class="highlight"><pre><code class="javascript"><span class="kr">import</span> <span class="nx">React</span> <span class="nx">from</span> <span class="s1">&#39;react&#39;</span><span class="p">;</span>

<span class="kr">class</span> <span class="nx">YourComponent</span> <span class="kr">extends</span> <span class="nx">React</span><span class="p">.</span><span class="nx">Component</span> <span class="p">{</span>
  <span class="nx">componentDidUpdate</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">someFunction</span><span class="p">();</span>
  <span class="p">}</span>

  <span class="nx">someFunction</span><span class="p">()</span> <span class="p">{</span>
    <span class="c1">// ...</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>


<p>Now say you want to test that <code>componentDidUpdate</code> calls <code>this.someFunction()</code>.</p>

<p>Because the props for the component are set on initial render, and cannot change after that, you can&#8217;t just render an instance of the component and manually update the props in your spec.</p>

<p>This is where <a href="https://www.npmjs.com/package/react-dom">react-dom</a> comes in. Use it to render the component with an initial set of props and then render the component again with different props.</p>

<p>react-dom will re-render the same instance of the component, instead of creating a brand new one each time.</p>

<div class="highlight"><pre><code class="javascript"><span class="kr">import</span> <span class="nx">React</span> <span class="nx">from</span> <span class="s1">&#39;react&#39;</span><span class="p">;</span>
<span class="kr">import</span> <span class="nx">ReactDOM</span> <span class="nx">from</span> <span class="s1">&#39;react-dom&#39;</span><span class="p">;</span>
<span class="kr">import</span> <span class="nx">YourComponent</span> <span class="nx">from</span> <span class="s1">&#39;path/to/your-component&#39;</span><span class="p">;</span>

<span class="nx">describe</span><span class="p">(</span><span class="s1">&#39;your-component&#39;</span><span class="p">,</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="nx">describe</span><span class="p">(</span><span class="s1">&#39;componentDidUpdate&#39;</span><span class="p">,</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="nx">it</span><span class="p">(</span><span class="s1">&#39;calls someFunction()&#39;</span><span class="p">,</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
      <span class="kd">let</span> <span class="nx">node</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">createElement</span><span class="p">(</span><span class="s1">&#39;div&#39;</span><span class="p">);</span>
      <span class="nx">instance</span> <span class="o">=</span> <span class="nx">ReactDOM</span><span class="p">.</span><span class="nx">render</span><span class="p">(</span><span class="o">&lt;</span><span class="nx">YourComponent</span> <span class="nx">yourProp</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;foo&#39;</span><span class="p">}</span> <span class="o">/&gt;</span><span class="p">,</span> <span class="nx">node</span><span class="p">);</span>
      <span class="nx">spyOn</span><span class="p">(</span><span class="nx">instance</span><span class="p">,</span> <span class="s1">&#39;someFunction&#39;</span><span class="p">);</span>
      <span class="nx">ReactDOM</span><span class="p">.</span><span class="nx">render</span><span class="p">(</span><span class="o">&lt;</span><span class="nx">YourComponent</span> <span class="nx">yourProp</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;bar&#39;</span><span class="p">}</span> <span class="o">/&gt;</span><span class="p">,</span> <span class="nx">node</span><span class="p">);</span>
      <span class="nx">expect</span><span class="p">(</span><span class="nx">instance</span><span class="p">.</span><span class="nx">someFunction</span><span class="p">).</span><span class="nx">toHaveBeenCalled</span><span class="p">();</span>
    <span class="p">});</span>
  <span class="p">});</span>
<span class="p">});</span>
</code></pre></div>



</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2015/07/09/rubymotion-inspect-paris-was-loads-of-fun/">RubyMotion #inspect Paris Was Loads of Fun</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2015-07-09T09:52:00+01:00" pubdate data-updated="true">Jul 9<span>th</span>, 2015</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>Last week was the <a href="http://conference.rubymotion.com/">RubyMotion #inspect 2015</a> conference
in Paris and not only was I lucky enough to attend, but I was also invited to speak about
the RubyMotion football manager game I built: <a href="http://www.titlchallenge.com">Title Challenge</a>.</p>

<p><a href="/images/rubymotion_paris.JPG" target="_blank"><img class="center" src="/images/rubymotion_paris.JPG" width="500" height="500" title="Paul at RubyMotion Paris" alt="Paul at RubyMotion Paris"></a></p>

<p>RubyMotion #inspect is a two-day conference and my talk was scheduled for the second day,
which is lucky for me as I missed day one due to protestors spontaneously deciding to
prevent the Eurostar from running the day I was due to travel. Fortunately the talks
were recorded, so hopefully these will be made available soon!</p>

<h2>RubyMotion 4</h2>

<p><a href="https://twitter.com/lrz">Laurent Sansonetti</a> announced what is planned for RubyMotion 4 and it sounds awesome:</p>

<ul>
<li>A new REPL to work on the device</li>
<li>Cross-platform game framework</li>
<li>WatchKit</li>
<li>iOS 9 support</li>
<li>More work on live code reloading</li>
</ul>


<h2>Inspiration</h2>

<p>It was great meeting the RubyMotion community and it definitely feels like an
extension of all of the good things from the Ruby and Ruby On Rails communities.
Lots of enthusiasm, smart and friendly people doing some really cool things.</p>

<p>For me conferences are all about being inspired and the two talks that stood out
were from <a href="https://twitter.com/amirrajan">Amir Rajan</a> and <a href="https://twitter.com/markrickert">Mark Rickert</a>.</p>

<p>Amir is the genius behind the game A Dark Room which reached #1 in the US App Store.
I thoroughly recommend <a href="http://amirrajan.net/a-dark-room/">reading his blog</a> which
tells the story as he lived it.</p>

<p>Mark told us about his experience quitting his full-time job, selling pretty much
everything he owned and living on the road. He now consults on RubyMotion projects
remotely, works half as much, makes more money and most importantly is far more happy!</p>

<p>If you get the chance to hear either of these guys speak then make sure you do.</p>

<h2>Life begins at the end of your comfort zone</h2>

<p>For my talk I discussed the major challenges that were faced in building the game.
Highlighting, where I could, lessons learned and things I would have done differently
having now gone through the experience.</p>

<p>What I had to say seemed to go down well. The team working on RedPotion have already
<a href="https://github.com/clearsightstudio/ProMotion/issues/712">made changes to the framework</a>
inspired by some simple ideas I had for debugging memory issues.</p>

<p>If there&#8217;s one point to take-away from my talk though it&#8217;s &#8220;Life begins at the end of your comfort zone&#8221;.
If you have an idea, just go for it and don&#8217;t be afraid to figure out things as
you go along!</p>

<p>Feel free to take a look at <a href="/downloads/rubymotion_inspect_2015_paul_sturgess.pdf">the slides for my presentation</a>.</p>

<p>If you have questions get in touch on twitter: <a href="https://twitter.com/paulsturgess">@paulsturgess</a>.</p>

<h2>WXG Conference – 25th Sept, Guildford, UK</h2>

<p>I will also be talking about Title Challenge at the <a href="http://wxg.co.uk/">WXG Conference</a>.</p>

<p>It&#8217;s a one day conference about web &amp; digital experiences.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2015/05/12/core-data-in-rubymotion-defining-your-schema-in-code/">Core Data in RubyMotion – Defining Your Schema in Code</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2015-05-12T10:55:00+01:00" pubdate data-updated="true">May 12<span>th</span>, 2015</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>One of the things I love about RubyMotion is being able to build applications without
having to heavily rely on XCode. I feel far more comfortable in a text editor, where I
can actually see the code that makes it work.</p>

<p>Typically Core Data schemas are defined in XCode, with text fields and drop down options
used to define the attributes, relationships etc.</p>

<p>Fortunately for RubyMotion developers the fantastic <a href="https://github.com/infinitered/ruby-xcdm">ruby-xcdm</a>
allows us to define our schema in code.</p>

<p>This may seem like more work, but one of benefits to defining the schema in code is
visibility. With the schema checked into version control, it&#8217;s easy to see how it has
evolved over time. Who made the changes, when they made those changes and hopefully
the commit message might even say why they made those changes.</p>

<p>The <a href="https://github.com/infinitered/ruby-xcdm/blob/master/README.md">ruby-xcdm Readme</a> does a great
job of explaining how to set it up. However, I would like to talk a bit about versioning.</p>

<p>If you&#8217;re coming from a Ruby on Rails background (as I was) then CoreData doesn&#8217;t really &#8216;do&#8217;
migrations like ActiveRecord does. I&#8217;d recommend reading up on the term &#8216;lightweight migration&#8217; in
the Apple docs. Essentially for simple things, like adding or removing attributes, it can do these
automatically and they can be performed using ruby-xcdm.</p>

<p>To make this work, all you need to do is copy your schema and create a new file.
Just make sure you increment the schema number and as long as you have&#8230;</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">task</span> <span class="ss">:&quot;build:simulator&quot;</span> <span class="o">=&gt;</span> <span class="ss">:&quot;schema:build&quot;</span>
</span></code></pre></td></tr></table></div></figure>


<p>&#8230;in your Rakefile, then the schema will be built and CoreData will perform the migration.</p>

<p>Ruby-xcdm can handle typical relationship types like <code>has_many</code>, <code>has_one</code> and <code>belongs_to</code>. It also
can handle entities that inherit from a base entity - just lookup the <code>abstract: true</code> and <code>parent:</code> options.</p>

<h2>Shameless plug</h2>

<p>This article is part of a series of blog posts about how I built <a href="http://titlechallenge.com">Title Challenge</a> – A football manager game for iOS.</p>

<p>Others i&#8217;ve written include:</p>

<ul>
<li><a href="http://paulsturgess.co.uk/blog/2015/03/03/using-paintcode-to-dynamically-create-images-in-the-ios-football-manager-game-title-challenge/">Using PaintCode to Dynamically Create Images</a></li>
<li><a href="http://paulsturgess.co.uk/blog/2015/02/13/using-reveal-app-to-build-a-rubymotion-football-manager-game/">Debuging layout issues with RevealApp</a></li>
<li><a href="http://paulsturgess.co.uk/blog/2015/02/17/how-you-can-use-core-data-to-make-your-rubymotion-app-faster/">How to use Core Data to make your app faster</a>.</li>
<li><a href="http://paulsturgess.co.uk/blog/2015/02/05/tweeting-a-screenshot-in-rubymotion-with-uiactivityviewcontroller/">Tweeting a Screenshot with UIActivityViewController</a></li>
</ul>


<p>Please do check out <a href="http://itunes.apple.com/app/id959982756">Title Challenge on the App Store</a>.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2015/03/03/using-paintcode-to-dynamically-create-images-in-the-ios-football-manager-game-title-challenge/">Using PaintCode to Dynamically Create Images in the iOS Football Manager Game Title Challenge</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2015-03-03T15:26:00+00:00" pubdate data-updated="true">Mar 3<span>rd</span>, 2015</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>One of the important and distinctive visual aspects of <a href="http://www.titlechallenge.com">Title Challenge</a> is for each football club to have their own shirt and colour theme. The home and away shirts are used on nearly all screens, with the front of the shirts representing a club and the rear of the shirts, with a number on the back, representing a player.</p>

<p>There are over 250 clubs in the database that ships with the game. Each club has 2 shirts and we need several different sizes for different screens. We also had to consider that club shirts will potentially change in both colour and style each season going forward. On top of this, we wanted to support different device resolutions including both retina and non-retina resolutions.</p>

<p>To create a fixed set of graphics of thousands of combinations in varying sizes, styles and colours would have been laborious to say the least and incredibly time consuming to maintain. It also would have enormously bloated the file size of our application.</p>

<h2>Shirt Styles</h2>

<p>We decided we wanted to be able to dynamically display, hide, colour and scale graphical components with code. This would allow us to display any club shirt on the fly.</p>

<p>The first phase was to decide on some core shirt styles that covered the majority of shirts worn by football clubs. We came up with 6: Plain, Stripes, Hoops, Sleeves, Quarters and Halves. We also have a goalkeeper shirt and a substitute bib used for players on the bench.</p>

<p><a href="/images/shirt_styles.png" target="_blank"><img class="left" src="/images/shirt_styles.png" width="825" height="825" title="Shirt Layers image" alt="Shirt Layers image"></a></p>

<p>The image above shows the different shirt styles in Title Challenge</p>

<h2>Vector Layers</h2>

<p>After deciding on the styles, Thom, our designer, produced a set of modular vector graphics that could be layered over each other to create any kit style required without duplicating any of the kit elements.</p>

<p>However, those vector graphics weren’t used directly in the game. The shirts you see are entirely generated from code. To achieve this, each individual shirt element was imported into a third party application called <a href="http://www.paintcodeapp.com/">PaintCode</a>.</p>

<p><a href="/images/shirt_layers.png" target="_blank"><img class="left" src="/images/shirt_layers.png" width="825" height="825" title="Shirt Layers image" alt="Shirt Layers image"></a></p>

<p>The image above shows the layers that make up a black and white striped shirt with a green substitute bib.</p>

<h2>PaintCode</h2>

<p><a href="http://www.paintcodeapp.com/">PaintCode</a> is genius, it automatically generates drawing code from vector graphics.</p>

<p>The code to generate a shirt is actually composed of the same graphical modular layers composed on top of one another, but instead of vector graphics, they’re CALayers composed of UIBezierPath line segments with different fills and strokes.</p>

<p>Even the shirt numbers have been generated using PaintCode. We could have used a font, and we did look for one, but we couldn’t quite find the right one. We wanted one loosely inspired by the <a href="http://goo.gl/nCCUqC">Mexico ‘86 world cup</a>, but with a modern feel.</p>

<p>In the end it was easier to implement all elements of the shirt using the same code-based method. This was particularly true when we were dealing with scaling and animations on the tactics screen.</p>

<p><a href="/images/paintcode.png" target="_blank"><img class="left" src="/images/paintcode.png" width="825" height="825" title="Paintcode screenshot" alt="Paintcode screenshot"></a></p>

<p>Screenshot of <a href="http://www.paintcodeapp.com/">Paintcode</a> with the code in the panel below the shirt vector graphic.</p>

<h2>Turn it off and on again</h2>

<p>To generate the front or rear of a shirt, we simply show/hide a different collar style. We also show/hide the player number as appropriate. The goalkeeper shirt is just a plain shirt with some extra sleeves added on. For bibs, we simply add the bib layer straight over the top.</p>

<p>Basically we just turn layers on and off and change the colours to produce the shirt combination we want. Taking this approach means that making tweaks are a joy to implement and not a chore to dread.</p>

<p>Another benefit is we were able to include the shirts as part of data editor in the game. So any shirt style can be created completely on the fly using a color picker.</p>

<p>We also changed the shirt style several times during the development of Title Challenge. I have no affiliation with <a href="http://www.paintcodeapp.com/">PaintCode</a>, but I&#8217;m so glad we used it!</p>

<h2>Shameless plug</h2>

<p>If you got this far and you&#8217;re still wondering what Title Challenge is or you found this post useful and just feel like supporting me – Please do check out <a href="http://itunes.apple.com/app/id959982756">Title Challenge on the App Store</a>.</p>

<p>I&#8217;ve also written some other posts about developing Title Challenge: <a href="http://paulsturgess.co.uk/blog/2015/02/13/using-reveal-app-to-build-a-rubymotion-football-manager-game/">Debuging layout issues with RevealApp</a> and <a href="http://paulsturgess.co.uk/blog/2015/02/17/how-you-can-use-core-data-to-make-your-rubymotion-app-faster/">How to use Core Data to make your app faster</a>.</p>

<p><a href="/images/tactics.png" target="_blank"><img class="left" src="/images/tactics.png" width="825" height="825" title="Tactics screenshot" alt="Tactics screenshot"></a></p>
</div>
  
  


    </article>
  
  <div class="pagination">
    
      <a class="prev" href="/blog/page/2/">&larr; Older</a>
    
    
  </div>
</div>
<aside class="sidebar">
  
    <section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/blog/2017/01/11/simple-method-for-checking-the-mime-type-for-a-file-in-ruby-on-rails/">Simple method for checking a file mime type in Ruby on Rails</a>
      </li>
    
      <li class="post">
        <a href="/blog/2016/11/20/functional-programming-for-a-rubyist/">Functional Programming for a Rubyist</a>
      </li>
    
      <li class="post">
        <a href="/blog/2016/11/06/how-to-write-and-test-a-redux-container-component-for-react/">How to write and test a Redux Container Component for React</a>
      </li>
    
      <li class="post">
        <a href="/blog/2016/10/19/how-to-write-and-test-a-stateless-react-component/">How to write and test a stateless React component</a>
      </li>
    
      <li class="post">
        <a href="/blog/2016/10/14/safer-rebasing-with-git/">Safer rebasing with Git</a>
      </li>
    
  </ul>
</section>

<section>
  <h1>GitHub Repos</h1>
  <ul id="gh_repos">
    <li class="loading">Status updating&#8230;</li>
  </ul>
  
  <a href="https://github.com/paulsturgess">@paulsturgess</a> on GitHub
  
  <script type="text/javascript">
    $(document).ready(function(){
        if (!window.jXHR){
            var jxhr = document.createElement('script');
            jxhr.type = 'text/javascript';
            jxhr.src = '/javascripts/libs/jXHR.js';
            var s = document.getElementsByTagName('script')[0];
            s.parentNode.insertBefore(jxhr, s);
        }

        github.showRepos({
            user: 'paulsturgess',
            count: 0,
            skip_forks: true,
            target: '#gh_repos'
        });
    });
  </script>
  <script src="/javascripts/github.js" type="text/javascript"> </script>
</section>





  
</aside>

    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2017 - Paul Sturgess -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  











</body>
</html>
